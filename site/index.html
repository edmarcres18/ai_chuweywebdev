<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChuweyWebDev AI Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 30px rgba(59, 130, 246, 0.8); }
        }
        @keyframes typing {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        .animate-pulse-glow { animation: pulseGlow 2s infinite; }
        .animate-typing { animation: typing 1.5s infinite; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen">
    <!-- Authentication Overlay -->
    <div id="authOverlay" class="fixed inset-0 bg-slate-900 z-50 flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-slate-800/70 backdrop-blur-lg border border-slate-700 rounded-3xl overflow-hidden animate-fade-in">
            <!-- Tabs -->
            <div class="flex justify-around border-b border-slate-700">
                <button id="loginTab" class="px-6 py-3 text-white font-medium border-b-2 border-blue-500">Login</button>
                <button id="registerTab" class="px-6 py-3 text-slate-400 hover:text-white transition-colors">Register</button>
            </div>
            <!-- Login Form -->
            <form id="loginForm" class="p-6 space-y-4">
                <h2 class="text-2xl font-bold text-white mb-4">Welcome Back</h2>
                <div class="space-y-1">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                            </svg>
                        </div>
                        <input type="email" id="loginEmail" placeholder="Email" required class="w-full bg-slate-700/50 border border-slate-600 rounded-xl pl-10 px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50">
                    </div>
                    <div id="loginEmailError" class="text-red-400 text-xs hidden">Please enter a valid email</div>
                </div>
                
                <div class="space-y-1">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <input type="password" id="loginPassword" placeholder="Password" required class="w-full bg-slate-700/50 border border-slate-600 rounded-xl pl-10 px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="loginPasswordError" class="text-red-400 text-xs hidden">Password is required</div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <input id="remember-me" name="remember-me" type="checkbox" class="h-4 w-4 bg-slate-700 border-slate-600 rounded text-blue-500 focus:ring-blue-500/50">
                        <label for="remember-me" class="ml-2 block text-sm text-slate-400">Remember me</label>
                    </div>
                    <div class="text-sm">
                        <a href="#" id="forgotPassword" class="text-blue-400 hover:text-blue-300">Forgot password?</a>
                    </div>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-2.5 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 mt-2 flex items-center justify-center">
                    <span>Sign In</span>
                    <svg id="loginSpinner" class="animate-spin ml-2 h-4 w-4 text-white hidden" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                
                <div id="loginErrorMessage" class="bg-red-500/20 border border-red-500/30 text-red-200 text-sm rounded-lg p-3 hidden"></div>
                
                <div class="relative flex py-3 items-center">
                    <div class="flex-grow border-t border-slate-700"></div>
                    <span class="flex-shrink mx-3 text-slate-500 text-sm">Or continue with</span>
                    <div class="flex-grow border-t border-slate-700"></div>
                </div>
                
                <div>
                    <button type="button" id="googleSignIn" class="w-full flex items-center justify-center py-2 px-4 bg-slate-700/50 hover:bg-slate-700 border border-slate-600 rounded-xl transition-colors">
                        <svg class="h-5 w-5 mr-2" viewBox="0 0 24 24">
                            <path fill="#EA4335" d="M5.266 9.764C6.294 7.403 8.492 5.75 11.069 5.75c1.581 0 3.012.633 4.094 1.657l3.083-3.075C16.506 2.695 13.967 1.75 11.069 1.75 6.502 1.75 2.578 4.522 1 8.463l4.266 1.301z"></path>
                            <path fill="#FBBC05" d="M11.069 22.25c2.898 0 5.437-.945 7.177-2.582l-3.083-3.075c-1.082 1.024-2.513 1.657-4.094 1.657-2.577 0-4.775-1.653-5.803-4.014L1 15.537c1.578 3.941 5.502 6.713 10.069 6.713z"></path>
                            <path fill="#4285F4" d="M22.468 12.025c0-.693-.061-1.391-.181-2.075H11.069v4.125h6.458c-.278 1.486-1.123 2.75-2.394 3.594l3.083 3.075c1.809-1.676 2.852-4.138 2.852-7.019z"></path>
                            <path fill="#34A853" d="M5.266 14.236c-.239-.686-.376-1.421-.376-2.186s.137-1.5.376-2.186v-1.301l-4.266-1.301C.379 8.863 0 10.4 0 12.05s.379 3.188 1 4.788l4.266-1.301v-1.301z"></path>
                        </svg>
                        <span class="text-white text-sm">Continue with Google</span>
                    </button>
                </div>
            </form>
            
            <!-- Register Form (hidden initially) -->
            <form id="registerForm" class="p-6 space-y-4 hidden">
                <h2 class="text-2xl font-bold text-white mb-4">Create Account</h2>
                <div class="space-y-1">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </div>
                        <input type="text" id="registerName" placeholder="Full Name" required class="w-full bg-slate-700/50 border border-slate-600 rounded-xl pl-10 px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50">
                    </div>
                    <div id="registerNameError" class="text-red-400 text-xs hidden">Please enter your full name</div>
                </div>
                
                <div class="space-y-1">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"></path>
                            </svg>
                        </div>
                        <input type="email" id="registerEmail" placeholder="Email" required class="w-full bg-slate-700/50 border border-slate-600 rounded-xl pl-10 px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50">
                    </div>
                    <div id="registerEmailError" class="text-red-400 text-xs hidden">Please enter a valid email</div>
                </div>
                
                <div class="space-y-1">
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="h-5 w-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                            </svg>
                        </div>
                        <input type="password" id="registerPassword" placeholder="Password" required class="w-full bg-slate-700/50 border border-slate-600 rounded-xl pl-10 px-4 py-2 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50">
                        <button type="button" class="toggle-password absolute inset-y-0 right-0 pr-3 flex items-center text-slate-400 hover:text-white">
                            <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="registerPasswordError" class="text-red-400 text-xs hidden">Password must be at least 6 characters</div>
                </div>
                
                <!-- Password strength meter -->
                <div class="space-y-1">
                    <div class="h-1 w-full bg-slate-700 rounded-full overflow-hidden">
                        <div id="passwordStrength" class="h-full w-0 bg-red-500 transition-all duration-300"></div>
                    </div>
                    <div id="passwordStrengthText" class="text-xs text-slate-400">Password strength</div>
                </div>
                
                <div class="flex items-center">
                    <input id="terms" name="terms" type="checkbox" required class="h-4 w-4 bg-slate-700 border-slate-600 rounded text-blue-500 focus:ring-blue-500/50">
                    <label for="terms" class="ml-2 block text-sm text-slate-400">
                        I agree to the <a href="#" class="text-blue-400 hover:text-blue-300">Terms of Service</a> and <a href="#" class="text-blue-400 hover:text-blue-300">Privacy Policy</a>
                    </label>
                </div>
                
                <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-2.5 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all duration-200 mt-2 flex items-center justify-center">
                    <span>Create Account</span>
                    <svg id="registerSpinner" class="animate-spin ml-2 h-4 w-4 text-white hidden" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                
                <div id="registerErrorMessage" class="bg-red-500/20 border border-red-500/30 text-red-200 text-sm rounded-lg p-3 hidden"></div>
            </form>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="mainApp" class="hidden">
        <!-- Header -->
        <header class="border-b border-slate-700/50 backdrop-blur-lg bg-slate-900/80 sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">ChuweyWebDev AI</h1>
                            <p class="text-sm text-slate-400">Intelligent Development Assistant</p>
                        </div>
                    </div>
                <div class="flex items-center space-x-4">

                    <!-- Model Selector -->
                    <div class="relative">
                        <select id="modelSelector" class="bg-slate-800 border border-slate-600 text-white rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 appearance-none pr-8">
                            <option value="phi:latest">Phi</option>
                            <option value="deepseek-coder:6.7b-instruct">DeepSeekCoder</option>
                            <option value="mistral:latest">Mistral</option>
                        </select>
                        <svg class="absolute right-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-slate-400 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </div>
                    <!-- User Info (when logged in) -->
                    <div id="userInfo" class="hidden relative">
                        <button id="userDropdownButton" class="flex items-center space-x-2 pr-2 border-r border-slate-700 focus:outline-none">
                            <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                                <span id="userInitials" class="text-white text-xs font-medium"></span>
                            </div>
                            <div class="flex items-center">
                                <span id="userName" class="text-white text-sm font-medium"></span>
                                <svg class="w-4 h-4 ml-1 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </button>
                        
                        <!-- User Dropdown Menu -->
                        <div id="userDropdown" class="absolute right-0 mt-2 w-48 bg-slate-800 rounded-xl shadow-lg py-1 z-50 border border-slate-700 hidden">
                            <div class="px-4 py-3 border-b border-slate-700">
                                <p class="text-sm text-slate-400">Signed in as</p>
                                <p id="userEmail" class="text-sm font-medium text-white truncate"></p>
                            </div>
                            <a href="#" class="block px-4 py-2 text-sm text-white hover:bg-slate-700 transition-colors">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    Settings
                                </div>
                            </a>
                            <a href="#" id="profileDropdownLogout" class="block px-4 py-2 text-sm text-white hover:bg-slate-700 transition-colors">
                                <div class="flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                    </svg>
                                    Sign out
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Welcome Section -->
        <div class="text-center mb-8 animate-fade-in">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-purple-600 rounded-2xl mb-4 animate-pulse-glow">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">How can I help you today?</h2>
            <p class="text-slate-400 text-lg">Ask me anything about web development, coding, or project assistance</p>
        </div>

        <!-- Quick Actions -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <button class="group p-6 bg-slate-800/50 border border-slate-700/50 rounded-2xl hover:bg-slate-800/80 hover:border-blue-500/50 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/10">
                <div class="w-10 h-10 bg-blue-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:bg-blue-500/30 transition-colors">
                    <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                </div>
                <h3 class="text-white font-semibold mb-2">Code Review</h3>
                <p class="text-slate-400 text-sm">Get expert feedback on your code</p>
            </button>
            
            <button class="group p-6 bg-slate-800/50 border border-slate-700/50 rounded-2xl hover:bg-slate-800/80 hover:border-purple-500/50 transition-all duration-300 hover:shadow-lg hover:shadow-purple-500/10">
                <div class="w-10 h-10 bg-purple-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:bg-purple-500/30 transition-colors">
                    <svg class="w-5 h-5 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                </div>
                <h3 class="text-white font-semibold mb-2">Project Ideas</h3>
                <p class="text-slate-400 text-sm">Brainstorm and plan new projects</p>
            </button>
            
            <button class="group p-6 bg-slate-800/50 border border-slate-700/50 rounded-2xl hover:bg-slate-800/80 hover:border-green-500/50 transition-all duration-300 hover:shadow-lg hover:shadow-green-500/10">
                <div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center mb-4 group-hover:bg-green-500/30 transition-colors">
                    <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-white font-semibold mb-2">Debug Help</h3>
                <p class="text-slate-400 text-sm">Solve coding problems quickly</p>
            </button>
        </div>

        <!-- Chat Container -->
        <div class="bg-slate-800/30 backdrop-blur-sm border border-slate-700/50 rounded-3xl overflow-hidden">
            <!-- Chat Messages -->
            <div id="chatMessages" class="h-96 overflow-y-auto p-6 space-y-4">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3 animate-slide-up">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                    </div>
                    <div class="bg-slate-700/50 rounded-2xl rounded-tl-sm px-4 py-3 max-w-md">
                        <p class="text-slate-200">Hello! I'm your ChuweyWebDev AI Assistant. I'm here to help you with web development, coding challenges, project planning, and technical questions. What would you like to work on today?</p>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-slate-700/50 p-4">
                <div class="flex items-end space-x-3">
                    <button class="p-2 text-slate-400 hover:text-white transition-colors rounded-lg hover:bg-slate-700/50">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                        </svg>
                    </button>
                    <div class="flex-1 relative">
                        <textarea 
                            id="messageInput"
                            placeholder="Type your message here..." 
                            class="w-full bg-slate-700/50 border border-slate-600/50 rounded-2xl px-4 py-3 pr-12 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-transparent resize-none max-h-32"
                            rows="1"
                            maxlength="5000"
                        ></textarea>
                        <button 
                            id="sendButton"
                            class="absolute right-2 bottom-2 p-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 hover:shadow-lg hover:shadow-blue-500/25 disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="flex items-center justify-between mt-3 text-xs text-slate-400">
                    <div class="flex items-center space-x-4">
                        <span class="flex items-center">
                            <div id="statusIndicator" class="w-2 h-2 bg-green-400 rounded-full mr-2"></div>
                            <span id="statusText">AI Online</span>
                        </span>
                        <span>Press Enter to send</span>
                        <span id="currentModel" class="text-blue-400">Using: Phi</span>
                    </div>
                    <span id="charCount">0/5000</span>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-slate-400 text-sm">
            <p>Powered by ChuweyWebDev AI • Built with modern web technologies</p>
        </div>
    </div>

    <script>
        // Configuration
        const API_ENDPOINT = 'https://ollama.mhrpci.site/api/generate';
        const MODELS = {
            'phi:latest': 'Phi',
            'deepseek-coder:6.7b-instruct': 'DeepSeekCoder', 
            'mistral:latest': 'Mistral'
        };

        // DOM Elements
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const charCount = document.getElementById('charCount');
        const modelSelector = document.getElementById('modelSelector');
        const currentModel = document.getElementById('currentModel');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');

        // State
        let isGenerating = false;
        let conversationHistory = [];

        // Initialize
        updateModelDisplay();
        checkAPIStatus();

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
            
            // Update character count
            const count = this.value.length;
            charCount.textContent = `${count}/5000`;
            charCount.className = count > 4800 ? 'text-red-400' : 'text-slate-400';
            
            // Enable/disable send button
            sendButton.disabled = this.value.trim() === '' || count > 5000 || isGenerating;
        });

        // Handle Enter key
        messageInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Model selector change
        modelSelector.addEventListener('change', function() {
            updateModelDisplay();
        });

        // Update model display
        function updateModelDisplay() {
            const selectedModel = modelSelector.value;
            currentModel.textContent = `Using: ${MODELS[selectedModel]}`;
        }

        // Check API status
        async function checkAPIStatus() {
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: 'phi:latest',
                        prompt: 'test',
                        stream: false
                    })
                });
                
                if (response.ok) {
                    setStatus('online', 'AI Online');
                } else {
                    setStatus('warning', 'API Limited');
                }
            } catch (error) {
                setStatus('offline', 'AI Offline');
            }
        }

        // Set status
        function setStatus(status, text) {
            statusText.textContent = text;
            statusIndicator.className = `w-2 h-2 rounded-full mr-2 ${
                status === 'online' ? 'bg-green-400' : 
                status === 'warning' ? 'bg-yellow-400' : 'bg-red-400'
            }`;
        }

        // Send message function
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isGenerating) return;

            // Add user message
            addMessage(message, 'user');
            conversationHistory.push({ role: 'user', content: message });
            
            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            charCount.textContent = '0/5000';
            sendButton.disabled = true;
            isGenerating = true;

            // Show typing indicator
            addTypingIndicator();
            setStatus('warning', 'Generating...');

            try {
                const response = await callOllamaAPI(message);
                removeTypingIndicator();
                addMessage(response, 'ai');
                conversationHistory.push({ role: 'assistant', content: response });
                setStatus('online', 'AI Online');
            } catch (error) {
                removeTypingIndicator();
                addMessage('Sorry, I encountered an error while processing your request. Please try again.', 'ai', true);
                setStatus('offline', 'Connection Error');
                console.error('API Error:', error);
            } finally {
                isGenerating = false;
                sendButton.disabled = false;
            }
        }

        // Call Ollama API
        async function callOllamaAPI(prompt) {
            const selectedModel = modelSelector.value;
            
            // Build context from conversation history
            let contextPrompt = '';
            if (conversationHistory.length > 0) {
                contextPrompt = conversationHistory.slice(-6).map(msg => 
                    `${msg.role === 'user' ? 'User' : 'Assistant'}: ${msg.content}`
                ).join('\n') + '\nUser: ' + prompt + '\nAssistant:';
            } else {
                contextPrompt = `You are ChuweyWebDev AI Assistant, a helpful AI that specializes in web development, coding, and technical assistance. Be helpful, concise, and professional.\n\nUser: ${prompt}\nAssistant:`;
            }

            const requestBody = {
                model: selectedModel,
                prompt: contextPrompt,
                stream: false,
                options: {
                    temperature: 0.7,
                    top_p: 0.9,
                    max_tokens: 5000
                }
            };

            const response = await fetch(API_ENDPOINT, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const data = await response.json();
            
            if (data.error) {
                throw new Error(data.error);
            }

            return data.response || 'No response received from the model.';
        }

        // Add message to chat
        function addMessage(text, type, isError = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex items-start space-x-3 animate-slide-up ${type === 'user' ? 'flex-row-reverse space-x-reverse' : ''}`;
            
            const avatar = type === 'user' 
                ? `<div class="w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0">
                     <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                     </svg>
                   </div>`
                : `<div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                     <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                     </svg>
                   </div>`;

            const messageClass = type === 'user' 
                ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl rounded-tr-sm'
                : isError 
                ? 'bg-red-500/20 border border-red-500/30 text-red-200 rounded-2xl rounded-tl-sm'
                : 'bg-slate-700/50 text-slate-200 rounded-2xl rounded-tl-sm';

            // Format text for better display
            const formattedText = formatMessage(text);

            messageDiv.innerHTML = `
                ${avatar}
                <div class="${messageClass} px-4 py-3 max-w-md">
                    <div>${formattedText}</div>
                </div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Format message text with enhanced code handling
        function formatMessage(text) {
            // Enhanced code block detection with language support
            let formatted = text.replace(/```(\w*)\n([\s\S]*?)```/g, 
                (match, lang, code) => {
                    const language = lang || 'plaintext';
                    const escapedCode = escapeHtml(code);
                    const runButton = language === 'html' || language === 'javascript' || language === 'css' 
                        ? `<button class="run-code-btn mt-2 px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white text-xs rounded-lg transition-colors" 
                           data-lang="${language}" data-code="${encodeURIComponent(code)}">
                           Run Code ▶
                           </button>`
                        : '';
                    return `<div class="code-block my-2">
                            <div class="flex items-center justify-between bg-slate-800 px-3 py-1 rounded-t-lg">
                                <span class="text-xs text-slate-400">${language}</span>
                                <button class="copy-code-btn px-2 py-1 bg-slate-700 hover:bg-slate-600 text-slate-300 text-xs rounded transition-colors">
                                    Copy
                                </button>
                            </div>
                            <pre class="bg-slate-800 p-3 rounded-b-lg text-sm overflow-x-auto"><code class="language-${language}">${escapedCode}</code></pre>
                            ${runButton}
                        </div>`;
                })
                .replace(/`([^`]+)`/g, '<code class="bg-slate-800 px-1 rounded text-sm">$1</code>')
                .replace(/\n/g, '<br>');

            return formatted;
        }

        // Helper to escape HTML
        function escapeHtml(unsafe) {
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }

        // Add typing indicator
        function addTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typingIndicator';
            typingDiv.className = 'flex items-start space-x-3 animate-slide-up';
            typingDiv.innerHTML = `
                <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                </div>
                <div class="bg-slate-700/50 rounded-2xl rounded-tl-sm px-4 py-3">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-typing"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-typing" style="animation-delay: 0.2s;"></div>
                        <div class="w-2 h-2 bg-slate-400 rounded-full animate-typing" style="animation-delay: 0.4s;"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Remove typing indicator
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Send button click handler
        sendButton.addEventListener('click', sendMessage);

        // Handle code execution and copying
        document.addEventListener('click', function(e) {
            // Copy code button
            if (e.target.classList.contains('copy-code-btn')) {
                const codeBlock = e.target.closest('.code-block');
                const code = codeBlock.querySelector('code').textContent;
                navigator.clipboard.writeText(code).then(() => {
                    e.target.textContent = 'Copied!';
                    setTimeout(() => {
                        e.target.textContent = 'Copy';
                    }, 2000);
                });
            }
            
            // Run code button
            if (e.target.classList.contains('run-code-btn')) {
                const lang = e.target.dataset.lang;
                const code = decodeURIComponent(e.target.dataset.code);
                
                if (lang === 'html') {
                    const newWindow = window.open('', '_blank');
                    newWindow.document.write(code);
                    newWindow.document.close();
                } else if (lang === 'javascript') {
                    try {
                        // Create a safe execution environment
                        const script = document.createElement('script');
                        script.textContent = `(function() { ${code} })();`;
                        document.body.appendChild(script).remove();
                    } catch (error) {
                        alert(`Error executing JavaScript: ${error.message}`);
                    }
                } else if (lang === 'css') {
                    const style = document.createElement('style');
                    style.textContent = code;
                    document.head.appendChild(style);
                    setTimeout(() => style.remove(), 5000); // Remove after 5 seconds
                }
            }
        });

        // Quick action buttons
        document.querySelectorAll('.group').forEach(button => {
            button.addEventListener('click', function() {
                const title = this.querySelector('h3').textContent;
                const messages = {
                    'Code Review': 'Hi! I have some code that I\'d like you to review. Please analyze it thoroughly and provide executable solutions. Here\'s my code:\n```\n// Paste your code here\n```',
                    'Project Ideas': 'I\'m looking for some creative web development project ideas with complete code examples. What would you recommend for someone at my skill level?',
                    'Debug Help': 'I\'m encountering a bug in my code and I\'m not sure how to fix it. Please help me troubleshoot this issue. Here\'s the relevant code:\n```\n// Problematic code here\n```\nAnd the error message is: '
                };
                messageInput.value = messages[title] || '';
                messageInput.focus();
                messageInput.dispatchEvent(new Event('input'));
            });
        });

        // Load Prism.js for syntax highlighting
        const prismScript = document.createElement('script');
        prismScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js';
        prismScript.onload = () => {
            // Load additional language support
            const languages = ['javascript', 'css', 'html', 'php', 'sql'];
            languages.forEach(lang => {
                const langScript = document.createElement('script');
                langScript.src = `https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-${lang}.min.js`;
                document.head.appendChild(langScript);
            });
        };
        document.head.appendChild(prismScript);
        
        const prismCSS = document.createElement('link');
        prismCSS.rel = 'stylesheet';
        prismCSS.href = 'https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css';
        document.head.appendChild(prismCSS);

        // Periodic status check
        setInterval(checkAPIStatus, 30000); // Check every 30 seconds
    </script>
    </div>

    <script>
        // Initialize Supabase client with environment variables
        // NEXT_PUBLIC_SUPABASE_URL=https://hzepafzodfkjpihupzgy.supabase.co
        // NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZXBhZnpvZGZranBpaHVwemd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyOTQyMjAsImV4cCI6MjA2NTg3MDIyMH0.-xliHL9-ZyI44dNM7E3yOdakXnQ32M3E_RPBU-LjNC8
        const SUPABASE_URL = 'https://hzepafzodfkjpihupzgy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZXBhZnpvZGZranBpaHVwemd5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAyOTQyMjAsImV4cCI6MjA2NTg3MDIyMH0.-xliHL9-ZyI44dNM7E3yOdakXnQ32M3E_RPBU-LjNC8';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // OAuth redirect URL
        const REDIRECT_URL = window.location.origin;
        
        // Authentication state
        let isAuthenticated = false;

        // DOM Elements
        const authOverlay = document.getElementById('authOverlay');
        const mainApp = document.getElementById('mainApp');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        // Toast notification helper function
        function showToast(icon, title, text = '') {
            const Toast = Swal.mixin({
                toast: true,
                position: 'top-end',
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.addEventListener('mouseenter', Swal.stopTimer)
                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                }
            });
            
            Toast.fire({
                icon: icon, // 'success', 'error', 'warning', 'info', 'question'
                title: title,
                text: text
            });
        }

        // Add animation transitions for auth overlay
        function fadeInElement(element, delay = 0) {
            setTimeout(() => {
                element.style.opacity = '0';
                element.style.display = 'flex';
                setTimeout(() => {
                    element.style.opacity = '1';
                }, 50);
            }, delay);
        }

        function fadeOutElement(element, callback) {
            element.style.opacity = '0';
            element.style.transition = 'opacity 0.3s ease';
            setTimeout(() => {
                element.style.display = 'none';
                if (callback) callback();
            }, 300);
        }

        // OAuth sign in handler
        async function handleOAuthSignIn(provider) {
            try {
                // Show loading state with SweetAlert
                Swal.fire({
                    title: `Connecting to ${provider}...`,
                    text: 'Please wait while we redirect you',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                const { data, error } = await supabaseClient.auth.signInWithOAuth({
                    provider: provider,
                    options: {
                        redirectTo: REDIRECT_URL
                    }
                });
                
                if (error) throw error;
                
                // We won't reach here because the page will be redirected by Supabase
                console.log("OAuth redirect data:", data);
            } catch (error) {
                console.error(`${provider} OAuth error:`, error);
                Swal.close();
                showToast('error', 'Authentication failed', error.message || 'Please try again later');
            }
        }
        
        // Check for OAuth redirect response
        async function checkOAuthRedirect() {
            try {
                // Get the auth session (will automatically extract hash params from URL on redirect)
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                
                if (error) throw error;
                
                // Clear hash fragment from URL
                if (window.location.hash && window.location.hash.includes('access_token')) {
                    // Remove the hash without causing a page reload
                    history.replaceState(null, '', window.location.pathname + window.location.search);
                }
                
                if (session) {
                    // User is logged in via OAuth
                    isAuthenticated = true;
                    const { data: { user } } = await supabaseClient.auth.getUser();
                    
                    if (user) {
                        updateUserDisplay(user);
                        showToast('success', 'Signed in successfully');
                        
                        // Hide auth overlay, show main app
                        fadeOutElement(authOverlay, () => {
                            mainApp.classList.remove('hidden');
                            mainApp.style.opacity = '0';
                            mainApp.style.transition = 'opacity 0.3s ease';
                            setTimeout(() => {
                                mainApp.style.opacity = '1';
                            }, 50);
                        });
                    }
                }
            } catch (error) {
                console.error('OAuth redirect check error:', error);
                showToast('error', 'Authentication error', error.message);
            }
        }

        // Check if user is already logged in
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                // Apply transitions to auth overlay
                authOverlay.style.transition = 'opacity 0.3s ease';
                authOverlay.style.opacity = '1';
                
                // Check for OAuth redirect first
                await checkOAuthRedirect();
                
                // If not already authenticated via OAuth, check for existing session
                if (!isAuthenticated) {
                const { data: { user } } = await supabaseClient.auth.getUser();
                if (user) {
                    isAuthenticated = true;
                    updateUserDisplay(user);
                    fadeOutElement(authOverlay, () => {
                        mainApp.classList.remove('hidden');
                        mainApp.style.opacity = '0';
                        mainApp.style.transition = 'opacity 0.3s ease';
                        setTimeout(() => {
                            mainApp.style.opacity = '1';
                        }, 50);
                    });
                    }
                }
                
                // Apply form animations and transitions
                const formInputs = document.querySelectorAll('input');
                formInputs.forEach((input, index) => {
                    input.style.transform = 'translateY(10px)';
                    input.style.opacity = '0';
                    input.style.transition = 'all 0.3s ease';
                    
                    setTimeout(() => {
                        input.style.transform = 'translateY(0)';
                        input.style.opacity = '1';
                    }, 100 + (index * 50));
                });

                // Setup Google OAuth button
                document.getElementById('googleSignIn').addEventListener('click', () => handleOAuthSignIn('google'));

                // Setup user dropdown menu
                const userDropdownButton = document.getElementById('userDropdownButton');
                const userDropdown = document.getElementById('userDropdown');
                const profileDropdownLogout = document.getElementById('profileDropdownLogout');
                
                // Toggle dropdown when clicking the user button
                userDropdownButton?.addEventListener('click', function() {
                    userDropdown?.classList.toggle('hidden');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(event) {
                    if (userDropdownButton && userDropdown && !userDropdownButton.contains(event.target) && !userDropdown.contains(event.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
                
                // Handle logout from dropdown
                profileDropdownLogout?.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogout();
                });
                
            } catch (error) {
                console.error('Error during initialization:', error);
                // Show error toast for better user experience
                if (typeof showToast === 'function') {
                    showToast('error', 'Initialization error', 'Please refresh the page and try again.');
                }
            }
        });

        // Toggle between login and register forms
        loginTab.addEventListener('click', () => {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginTab.classList.add('border-b-2', 'border-blue-500');
            registerTab.classList.remove('border-b-2', 'border-blue-500');
        });

        registerTab.addEventListener('click', () => {
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            registerTab.classList.add('border-b-2', 'border-blue-500');
            loginTab.classList.remove('border-b-2', 'border-blue-500');
        });

        // Add logout functionality
        async function handleLogout() {
            try {
                // Show confirmation dialog with SweetAlert
                const result = await Swal.fire({
                    title: 'Sign Out',
                    text: 'Are you sure you want to sign out?',
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Yes, sign out',
                    cancelButtonText: 'Cancel',
                    confirmButtonColor: '#3B82F6',
                    cancelButtonColor: '#6B7280',
                    reverseButtons: true
                });
                
                if (!result.isConfirmed) {
                    return;
                }
                
                // Show loading state
                Swal.fire({
                    title: 'Signing out',
                    text: 'Please wait...',
                    allowOutsideClick: false,
                    didOpen: () => {
                        Swal.showLoading();
                    }
                });
                
                // Hide dropdown
                const userDropdown = document.getElementById('userDropdown');
                if (userDropdown) {
                    userDropdown.classList.add('hidden');
                }
                
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;
                
                isAuthenticated = false;
                
                // Hide user info
                const userInfo = document.getElementById('userInfo');
                if (userInfo) {
                    userInfo.classList.add('hidden');
                    userInfo.classList.remove('block');
                }
                
                // Fade out main app and fade in auth overlay with animation
                mainApp.style.opacity = '0';
                setTimeout(() => {
                    mainApp.classList.add('hidden');
                    
                    // Reset forms and hide error messages
                    loginForm.reset();
                    registerForm.reset();
                    
                    // Hide all error messages
                    document.getElementById('loginEmailError')?.classList.add('hidden');
                    document.getElementById('loginPasswordError')?.classList.add('hidden');
                    document.getElementById('loginErrorMessage')?.classList.add('hidden');
                    document.getElementById('registerNameError')?.classList.add('hidden');
                    document.getElementById('registerEmailError')?.classList.add('hidden');
                    document.getElementById('registerPasswordError')?.classList.add('hidden');
                    document.getElementById('registerErrorMessage')?.classList.add('hidden');
                    
                    // Reset password strength meter
                    const passwordStrength = document.getElementById('passwordStrength');
                    if (passwordStrength) {
                        passwordStrength.style.width = '0';
                        passwordStrength.className = 'h-full w-0 bg-red-500 transition-all duration-300';
                    }
                    const passwordStrengthText = document.getElementById('passwordStrengthText');
                    if (passwordStrengthText) {
                        passwordStrengthText.textContent = 'Password strength';
                        passwordStrengthText.className = 'text-xs text-slate-400';
                    }
                    
                    loginTab.click();
                    
                    // Reset Sign In button to original state
                    const loginSubmitBtn = loginForm.querySelector('button[type="submit"]');
                    const loginSubmitBtnText = loginSubmitBtn.querySelector('span');
                    loginSubmitBtnText.textContent = 'Sign In';
                    loginSubmitBtn.classList.remove('from-green-500', 'to-green-600');
                    loginSubmitBtn.classList.add('from-blue-500', 'to-purple-600');
                    loginSubmitBtn.disabled = false;
                    document.getElementById('loginSpinner')?.classList.add('hidden');
                    
                    // Reset Register button to original state
                    const registerSubmitBtn = registerForm.querySelector('button[type="submit"]');
                    const registerSubmitBtnText = registerSubmitBtn.querySelector('span');
                    registerSubmitBtnText.textContent = 'Create Account';
                    registerSubmitBtn.classList.remove('from-blue-500', 'to-blue-600');
                    registerSubmitBtn.classList.add('from-green-500', 'to-emerald-600');
                    registerSubmitBtn.disabled = false;
                    document.getElementById('registerSpinner')?.classList.add('hidden');
                    
                    // Show auth overlay with animation
                    authOverlay.style.display = 'flex';
                    authOverlay.style.opacity = '0';
                    setTimeout(() => {
                        authOverlay.style.opacity = '1';
                    }, 50);
                    
                    // Close SweetAlert and show success toast
                    Swal.close();
                    showToast('success', 'Signed out successfully');
                    
                }, 300);
                
            } catch (error) {
                console.error('Error signing out:', error);
                
                // Close SweetAlert loading
                Swal.close();
                
                // Show error toast
                showToast('error', 'Error signing out', error.message);
            }
        }

        // Enhanced Form Validation & UX
        function showInputError(inputEl, errorEl, message) {
            inputEl.classList.add('border-red-500');
            inputEl.classList.add('bg-red-500/10');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        function hideInputError(inputEl, errorEl) {
            inputEl.classList.remove('border-red-500');
            inputEl.classList.remove('bg-red-500/10');
            errorEl.classList.add('hidden');
        }

        // Password toggle functionality
        document.querySelectorAll('.toggle-password').forEach(button => {
            button.addEventListener('click', function() {
                const input = this.closest('.relative').querySelector('input');
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                
                // Toggle eye icon
                const svg = this.querySelector('svg');
                if (type === 'password') {
                    svg.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    `;
                } else {
                    svg.innerHTML = `
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                    `;
                }
            });
        });

        // Password strength meter
        document.getElementById('registerPassword').addEventListener('input', function() {
            const password = this.value;
            const strength = calculatePasswordStrength(password);
            const strengthBar = document.getElementById('passwordStrength');
            const strengthText = document.getElementById('passwordStrengthText');
            
            // Update strength bar width
            strengthBar.style.width = `${strength.score * 25}%`;
            
            // Update color based on strength
            if (strength.score === 0) {
                strengthBar.className = 'h-full w-0 bg-red-500 transition-all duration-300';
                strengthText.textContent = 'Password strength';
                strengthText.className = 'text-xs text-slate-400';
            } else if (strength.score === 1) {
                strengthBar.className = 'h-full bg-red-500 transition-all duration-300';
                strengthText.textContent = 'Weak';
                strengthText.className = 'text-xs text-red-400';
            } else if (strength.score === 2) {
                strengthBar.className = 'h-full bg-yellow-500 transition-all duration-300';
                strengthText.textContent = 'Fair';
                strengthText.className = 'text-xs text-yellow-400';
            } else if (strength.score === 3) {
                strengthBar.className = 'h-full bg-blue-500 transition-all duration-300';
                strengthText.textContent = 'Good';
                strengthText.className = 'text-xs text-blue-400';
            } else {
                strengthBar.className = 'h-full bg-green-500 transition-all duration-300';
                strengthText.textContent = 'Strong';
                strengthText.className = 'text-xs text-green-400';
            }
        });

        function calculatePasswordStrength(password) {
            let score = 0;
            
            // Length check
            if (password.length >= 8) score++;
            if (password.length >= 12) score++;
            
            // Complexity checks
            if (/[A-Z]/.test(password) && /[a-z]/.test(password)) score++;
            if (/[0-9]/.test(password)) score++;
            if (/[^A-Za-z0-9]/.test(password)) score++;
            
            return {
                score: Math.min(4, score)
            };
        }

        // Handle login form submission
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form elements
            const emailInput = document.getElementById('loginEmail');
            const emailError = document.getElementById('loginEmailError');
            const passwordInput = document.getElementById('loginPassword');
            const passwordError = document.getElementById('loginPasswordError');
            const errorMessage = document.getElementById('loginErrorMessage');
            
            // Reset previous errors
            hideInputError(emailInput, emailError);
            hideInputError(passwordInput, passwordError);
            errorMessage.classList.add('hidden');
            
            // Validate email
            const email = emailInput.value.trim();
            if (!email || !/\S+@\S+\.\S+/.test(email)) {
                showInputError(emailInput, emailError, 'Please enter a valid email address');
                return;
            }
            
            // Validate password
            const password = passwordInput.value;
            if (!password) {
                showInputError(passwordInput, passwordError, 'Password is required');
                return;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const submitBtnText = submitBtn.querySelector('span');
            const spinner = document.getElementById('loginSpinner');
            const originalBtnText = submitBtnText.textContent;
            const originalBtnClasses = {
                from: submitBtn.classList.contains('from-blue-500') ? 'from-blue-500' : 'from-green-500',
                to: submitBtn.classList.contains('to-purple-600') ? 'to-purple-600' : 'to-green-600'
            };
            
            submitBtnText.textContent = 'Signing in';
            spinner.classList.remove('hidden');
            submitBtn.disabled = true;
            
            try {
                const { data, error } = await supabaseClient.auth.signInWithPassword({
                    email,
                    password
                });
                
                if (error) throw error;
                
                // Successful login - show brief success message
                submitBtnText.textContent = 'Success!';
                spinner.classList.add('hidden');
                submitBtn.classList.remove(originalBtnClasses.from, originalBtnClasses.to);
                submitBtn.classList.add('from-green-500', 'to-green-600');
                
                // Get user data and update UI
                const { data: { user } } = await supabaseClient.auth.getUser();
                updateUserDisplay(user);
                
                // Show success toast
                showToast('success', 'Logged in successfully', 'Welcome back!');
                
                // Delayed transition to main app
                setTimeout(() => {
                    isAuthenticated = true;
                    fadeOutElement(authOverlay, () => {
                        mainApp.classList.remove('hidden');
                        mainApp.style.opacity = '0';
                        mainApp.style.transition = 'opacity 0.3s ease';
                        setTimeout(() => {
                            mainApp.style.opacity = '1';
                        }, 50);
                    });
                }, 700);
                
            } catch (error) {
                // Show error with SweetAlert toast
                showToast('error', 'Login failed', error.message || 'Please check your credentials.');
                console.error('Login error:', error);
                
                // Reset button state
                submitBtnText.textContent = originalBtnText;
                spinner.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.classList.remove('from-green-500', 'to-green-600');
                submitBtn.classList.add(originalBtnClasses.from, originalBtnClasses.to);
            }
        });

        // Function to update user display in UI
        function updateUserDisplay(user) {
            if (!user) return;
            
            const userInfo = document.getElementById('userInfo');
            const userName = document.getElementById('userName');
            const userInitials = document.getElementById('userInitials');
            const userEmail = document.getElementById('userEmail');
            
            // Get name from different possible metadata locations
            let fullName = '';
            
            // Check for different OAuth provider metadata formats
            if (user.user_metadata) {
                fullName = user.user_metadata.full_name || 
                           user.user_metadata.name || 
                           user.user_metadata.preferred_username ||
                           user.user_metadata.user_name || '';
            }
            
            // Fallback to email if no name is found
            if (!fullName && user.email) {
                fullName = user.email.split('@')[0] || 'User';
            } else if (!fullName) {
                fullName = 'User';
            }
            
            userName.textContent = fullName;
            
            // Set email
            userEmail.textContent = user.email || 'No email provided';
            
            // Generate initials
            const initials = fullName
                .split(' ')
                .map(name => name[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
            userInitials.textContent = initials;
            
            // Set avatar colors based on auth provider
            const avatarDiv = userInfo.querySelector('.w-8.h-8');
            if (user.app_metadata && user.app_metadata.provider === 'google') {
                avatarDiv.className = 'w-8 h-8 bg-gradient-to-r from-red-500 to-yellow-500 rounded-full flex items-center justify-center flex-shrink-0';
            } else {
                avatarDiv.className = 'w-8 h-8 bg-gradient-to-r from-green-500 to-blue-500 rounded-full flex items-center justify-center flex-shrink-0';
            }
            
            // Show user info
            userInfo.classList.remove('hidden');
            userInfo.classList.add('block');
            
            console.log('User authenticated:', user.app_metadata?.provider || 'email');
        }
        
        // User dropdown menu is now handled in the main DOMContentLoaded handler

        // Show forgot password form
        document.getElementById('forgotPassword').addEventListener('click', function(e) {
            e.preventDefault();
            
            // Use SweetAlert for email input
            Swal.fire({
                title: 'Reset Password',
                html: 'Please enter your email address to receive a password reset link',
                input: 'email',
                inputPlaceholder: 'Enter your email',
                showCancelButton: true,
                confirmButtonText: 'Send Reset Link',
                confirmButtonColor: '#3B82F6',
                cancelButtonColor: '#6B7280',
                inputValidator: (value) => {
                    if (!value) {
                        return 'Please enter your email address';
                    }
                    if (!/\S+@\S+\.\S+/.test(value.trim())) {
                        return 'Please enter a valid email address';
                    }
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    const emailInput = result.value;
                    
                    // Show loading state
                    Swal.fire({
                        title: 'Sending reset link',
                        text: 'Please wait...',
                        allowOutsideClick: false,
                        didOpen: () => {
                            Swal.showLoading();
                        }
                    });
                    
                    // Send password reset email
                    supabaseClient.auth.resetPasswordForEmail(emailInput.trim())
                        .then(() => {
                            Swal.close();
                            showToast('success', 'Password reset link sent!', 'Please check your email');
                        })
                        .catch(error => {
                            Swal.close();
                            showToast('error', 'Error sending reset link', error.message);
                            console.error('Password reset error:', error);
                        });
                }
            });
        });

        // Handle register form submission
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Get form elements
            const nameInput = document.getElementById('registerName');
            const nameError = document.getElementById('registerNameError');
            const emailInput = document.getElementById('registerEmail');
            const emailError = document.getElementById('registerEmailError');
            const passwordInput = document.getElementById('registerPassword');
            const passwordError = document.getElementById('registerPasswordError');
            const termsCheckbox = document.getElementById('terms');
            const errorMessage = document.getElementById('registerErrorMessage');
            
            // Reset previous errors
            hideInputError(nameInput, nameError);
            hideInputError(emailInput, emailError);
            hideInputError(passwordInput, passwordError);
            errorMessage.classList.add('hidden');
            
            // Validate name
            const name = nameInput.value.trim();
            if (!name || name.length < 2) {
                showInputError(nameInput, nameError, 'Please enter your full name (at least 2 characters)');
                return;
            }
            
            // Validate email
            const email = emailInput.value.trim();
            if (!email || !/\S+@\S+\.\S+/.test(email)) {
                showInputError(emailInput, emailError, 'Please enter a valid email address');
                return;
            }
            
            // Validate password
            const password = passwordInput.value;
            if (!password || password.length < 6) {
                showInputError(passwordInput, passwordError, 'Password must be at least 6 characters');
                return;
            }
            
            // Validate terms
            if (!termsCheckbox.checked) {
                errorMessage.textContent = 'You must agree to the Terms of Service and Privacy Policy';
                errorMessage.classList.remove('hidden');
                return;
            }
            
            // Show loading state
            const submitBtn = this.querySelector('button[type="submit"]');
            const submitBtnText = submitBtn.querySelector('span');
            const spinner = document.getElementById('registerSpinner');
            const originalBtnText = submitBtnText.textContent;
            const originalBtnClasses = {
                from: submitBtn.classList.contains('from-green-500') ? 'from-green-500' : 'from-blue-500',
                to: submitBtn.classList.contains('to-emerald-600') ? 'to-emerald-600' : 'to-blue-600'
            };
            
            submitBtnText.textContent = 'Creating account';
            spinner.classList.remove('hidden');
            submitBtn.disabled = true;
            
            try {
                // Register the user
                const { data, error } = await supabaseClient.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: name
                        }
                    }
                });
                
                if (error) throw error;
                
                if (data.user) {
                    if (data.user.identities && data.user.identities.length === 0) {
                        // Email already registered - show SweetAlert toast
                        showToast('warning', 'Email already registered', 'Please login instead');
                        
                        // Switch to login tab after a brief delay
                        setTimeout(() => {
                            loginTab.click();
                            // Auto-fill the email field
                            document.getElementById('loginEmail').value = email;
                        }, 1500);
                    } else {
                        // Success - show confirmation message
                        submitBtnText.textContent = 'Success!';
                        spinner.classList.add('hidden');
                        submitBtn.classList.remove(originalBtnClasses.from, originalBtnClasses.to);
                        submitBtn.classList.add('from-blue-500', 'to-blue-600');
                        
                        // Show success message with SweetAlert
                        Swal.fire({
                            icon: 'success',
                            title: 'Registration Successful!',
                            text: 'Please check your email to confirm your account.',
                            confirmButtonText: 'Continue',
                            confirmButtonColor: '#3B82F6',
                            timer: 5000,
                            timerProgressBar: true
                        }).then(() => {
                            // Switch to login tab
                            loginTab.click();
                            // Auto-fill the email field
                            document.getElementById('loginEmail').value = email;
                        });
                    }
                }
                
            } catch (error) {
                // Show error with SweetAlert toast
                showToast('error', 'Registration failed', error.message || 'Please try again');
                console.error('Registration error:', error);
                
                // Reset button state
                submitBtnText.textContent = originalBtnText;
                spinner.classList.add('hidden');
                submitBtn.disabled = false;
                submitBtn.classList.remove('from-blue-500', 'to-blue-600');
                submitBtn.classList.add(originalBtnClasses.from, originalBtnClasses.to);
            }
        });
    </script>
</body>
</html>